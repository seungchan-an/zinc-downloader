[tox]
envlist =
    # core supported python versions
    py39,
    py310,
    py311,
    py312,
    py313,
    # dependency compatibility matrix
    py310-old-deps,
    py311-latest-deps,
    py313-latest-deps

[testenv]
# default: balanced recent deps
deps =
    pytest>=8.0
    click>=8.0.0
    aiohttp>=3.13
    aiofiles>=22.1
    tqdm>=4.48.0
commands = pytest -v

# ---------- python version pinning ----------
[testenv:py39]
basepython = {env:HOME}/miniconda3/envs/py39/bin/python

[testenv:py310]
basepython = {env:HOME}/miniconda3/envs/py310/bin/python

[testenv:py311]
basepython = {env:HOME}/miniconda3/envs/py311/bin/python

[testenv:py312]
basepython = {env:HOME}/miniconda3/envs/py312/bin/python

[testenv:py313]
basepython = {env:HOME}/miniconda3/envs/py313/bin/python

# ---------- conservative compatibility sets ----------

# py310-old-deps
[testenv:py310-old-deps]
basepython = {env:HOME}/miniconda3/envs/py310/bin/python
deps =
    pytest>=8.0,<9.0
    click==8.1.8
    aiohttp==3.9.5
    aiofiles==23.2.1
    tqdm==4.66.3

# py311-latest-deps
[testenv:py311-latest-deps]
basepython = {env:HOME}/miniconda3/envs/py311/bin/python
deps =
    pytest>=9.0
    click>=8.1.8
    aiohttp>=3.13
    aiofiles>=25.1
    tqdm>=4.67

# py313-latest-deps
[testenv:py313-latest-deps]
basepython = {env:HOME}/miniconda3/envs/py313/bin/python
deps =
    pytest>=9.0
    click>=8.1.8
    aiohttp>=3.13
    aiofiles>=25.1
    tqdm>=4.67
